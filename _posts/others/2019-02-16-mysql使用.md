---
layout: post
title:  mysql使用
date:   2019-02-16 08:00:00 +0800
categories: 基础
tag: 数据库
---

* linux安装mysql   
https://blog.csdn.net/qq_15783243/article/details/78565705   
https://www.cnblogs.com/xinjing-jingxin/p/8025805.html   

* .scripts出错
yum -y install numactl

* 找不到/tmp/mysql.sock、mariadb.log错误
vi /etc/my/cnf   
修改   
socket=/tmp/mysql.sock   
log-error=/var/log/mariadb/mariadb.log   
pid-file=/var/run/mariadb/mariadb.pid   


* root用户登录名为mysql的数据库  
./mysql -u root mysql -p   

* 创建用户user1密码123456，且可以外部链接   
grant all on *.* to user1 identified by '123456';    


* 基本操作  
https://www.cnblogs.com/fly1988happy/archive/2011/12/15/2288554.html

* 查看表的存储引擎   
1 查看table_name `show create table table_name;`
2 查看MyDB的所有表引擎 

        select table_catalog
              ,table_schema
              ,table_name
              ,engine
        from information_schema.tables
        where table_schema='MyDB';
        //and engine='MyISAM';
        
* 优化

1. 前缀索引，前几位区分度高使用前几位即可，减小存储    
    给表email字段前六位添加索引`alter table SUser add index index2(email(6));`   
    分析区分度 可以用5%标准
    ```
    select 
      count(distinct left(email,4)）as L4,
      count(distinct left(email,5)）as L5,
      count(distinct left(email,6)）as L6,
      count(distinct left(email,7)）as L7,
    from SUser;
    ```

1. 身份证，后缀的区分度高   
    1反转存储   
    `select field_list from t where id_card = reverse('input_id_card_string');`   
    2hash存储   
    `alter table t add id_card_crc int unsigned, add index(id_card_crc);`   
    `select field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string'`
    
    首先，它们的相同点是，都不支持范围查询。倒序存储的字段上创建的索引是按照倒序字符串的方式排序的，已经没有办法利用索引方式查出身份证号码在[ID_X, ID_Y]的所有市民了。同样地，hash字段的方式也只能支持等值查询。
    
    它们的区别，主要体现在以下三个方面：
    
    从占用的额外空间来看，倒序存储方式在主键索引上，不会消耗额外的存储空间，而hash字段方法需要增加一个字段。当然，倒序存储方式使用4个字节的前缀长度应该是不够的，如果再长一点，这个消耗跟额外这个hash字段也差不多抵消了。
    
    在CPU消耗方面，倒序方式每次写和读的时候，都需要额外调用一次reverse函数，而hash字段的方式需要额外调用一次crc32()函数。如果只从这两个函数的计算复杂度来看的话，reverse函数额外消耗的CPU资源会更小些。
    
    从查询效率上看，使用hash字段方式的查询性能相对更稳定一些。因为crc32算出来的值虽然有冲突的概率，但是概率非常小，可以认为每次查询的平均扫描行数接近1。而倒序存储方式毕竟还是用的前缀索引的方式，也就是说还是会增加扫描行数。