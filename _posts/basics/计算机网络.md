![](https://raw.githubusercontent.com/glowwormX/note/master/imgs/net1.png)

所有路由器和主机都有连接相关的硬件（路由器、网卡）和软件（TCP/IP协议--网络通讯软件）   
   
    
计算机H1要给无线局域网计算机H2发QQ消息过程：   
0、QQ应用层   
1、（H1传输层）进程端口间通讯，通过端口发现这个数据是要给IP协议（HTTP默认TCP端口为80，FTP的TCP端口为21）的，给他发数据   
2、（H1网络层）H1的IP协议收到要发送的数据，封装成IP分组，通过分组交换，将大包拆成小包，每个小包上加上一些信息，要往外发，目的地址写上网关的IP（即路由器R1），协议写QQ这个进程的信息   
格式如下图   
![](https://raw.githubusercontent.com/glowwormX/note/master/imgs/net2.png)
    
   
    
3、（H1数据链路层）以太网卡收到IP分组数据后，又封装成以太网帧（格式如下图）发送下层   
![](https://raw.githubusercontent.com/glowwormX/note/master/imgs/net3.png)
    
图中帧首部有：目的地址48位、原地址48位、类型16位（给IP协议的为：0x0800）   
4、（H1物理层）物理层通过双绞线（图中为双绞线）、光纤、无线电发送   
5、（R1物理层->数据链路层->网络层）   
物理层接收   
数据链路层解析帧数据，发现类型为0x0800，交给R1中的IP协议处理、   
网络层：解析IP数据包，查路由表（下图为可能的路由表），目的IP地址与子网掩码计算后发现目的网络地址是192.168.3.12，所以发往IP为192.168.2.2的路由器，从E1接口出去（广域网接口）   
![](https://raw.githubusercontent.com/glowwormX/note/master/imgs/net4.png)
    
6、（R1网络层->数据链路层->物理层）又经过R1网络层重新封装新的IP数据报（这次改了目的IP等）   
链路层再封装成广域网帧（改了物理地址等），最后又物理层发送   
7、（R2物理层->数据链路层->网络层->数据链路层->物理层）物理层广域网接口接收一个数据   
数据链路层解析帧数据   
网络层查路由表后发现正好是给自己包的这个局域网的，把数据封装好（准备交付给H2的IP）后给R2的无线网卡，图中物理层是通过无线WIFI   
8、H2 无线网卡接收到帧后将IP分组交给IP协议，IP协议发现这是给自己的，查看IP数据报的协议字段后发现是给QQ的，在发送给H2上的QQ（应用层）
